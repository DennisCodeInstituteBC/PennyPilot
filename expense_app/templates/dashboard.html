{% extends 'base.html' %}
{% load static %}

{% block extra-css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">

{% endblock extra-css %}

{% block title %}
Dashboard
{% endblock title %}

{% block content %}
<section class="container">
    <!-- Navbar -->
    <nav class="navbar">
        <h2>PennyPilot</h2>
        <a href="{% url 'dashboard' %}">Dashboard</a>
        <a href="{% url 'expense_view' %}">Expense</a>
        <a href="{% url 'account' %}">Account</a>
        <a id="logout" href="{% url 'account_logout' %}">Logout</a>
    </nav>

    <!-- Content Area -->
    <article class="article">
        <div id="Page-Title">Dashboard</div>
        <!-- Charts -->
        <section class="graphs">
            <div class="pie-chart">
                <h2>Spending by Category</h2>
                <canvas id="expensePieChart"></canvas> <!-- Chart container -->
            </div>
        </section>

        <!-- Buttons -->
        <section class="option-buttons">
            <section class="expense-options">
                <button class="add-expense-btn"><a href="{% url 'add_expense' %}">Add New Expense</a></button>
            </section>
        </section>

        <!-- Recent Expense Report -->
        <section class="expense-table">
            <h2>Recent Expenses</h2>
            <!-- Display table of recent expenses here -->
        </section>
    </article>
</section>
{% endblock content %}
{% block extra-js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Include Chart.js -->
<script>
    const categories = JSON.parse('{{ categories|safe }}');  // Convert Django template data to JavaScript
    const totalSpendings = JSON.parse('{{ total_spendings|safe }}');

    // Pie chart setup
    const ctx = document.getElementById('expensePieChart').getContext('2d');
    const expensePieChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: categories,  // Category names from backend
            datasets: [{
                data: totalSpendings,  // Corresponding amounts from backend
                backgroundColor: [
                    '#007BFF', '#28A745', '#FFC107', '#17A2B8', '#DC3545'
                ],
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Spendings by Category'
                }
            }
        }
    });
</script>
{% endblock extra-js %}
